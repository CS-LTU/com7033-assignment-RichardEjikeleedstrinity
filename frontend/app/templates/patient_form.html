{% extends "base_dashboard.html" %}

{% block title %}{{ 'Edit' if patient else 'Add' }} Patient - Stroke Prediction{% endblock %}

{% block content %}
<div class="gap-1 px-6 flex flex-1 justify-center py-5">
    <!-- Left Sidebar - Patient Search -->
    <div class="layout-content-container flex flex-col w-80">
        <!-- Header for Patient Form -->
        <div class="flex flex-wrap justify-between gap-3 p-4">
            <p class="text-white tracking-light text-[32px] font-bold leading-tight min-w-72">Patient Form</p>
        </div>
        
        <!-- Search Bar -->
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3">
            <label class="flex flex-col min-w-40 flex-1">
                <p class="text-white text-base font-medium leading-normal pb-2">Search Patient</p>
                <input
                    placeholder="Search by name or ID"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                    value=""
                />
            </label>
        </div>

        <!-- Patient List -->
        <div class="space-y-2">
            {% for existing_patient in existing_patients %}
            <div class="flex items-center gap-4 bg-hospital-dark px-4 min-h-[72px] py-2 rounded-lg border border-hospital-border hover:border-medical-blue transition-colors cursor-pointer">
                <!-- Patient Age as Avatar -->
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full h-14 w-14 bg-hospital-card flex items-center justify-center text-white font-bold">
                {{ existing_patient.age }} 
                </div>
                <!-- Patient Details -->
                <div class="flex flex-col justify-center">
                    <p class="text-white text-base font-medium leading-normal line-clamp-1">{{ existing_patient.work_type }}</p>
                    <p class="text-hospital-text-light text-sm font-normal leading-normal line-clamp-2">ID: {{ existing_patient.patient_id }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Right Side - Patient Form -->
    <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
        <!-- Header for Add/Edit Patient -->
        <div class="flex flex-wrap justify-between gap-3 p-4">
            <p class="text-white tracking-light text-[32px] font-bold leading-tight min-w-72">
                {{ 'Edit Patient' if patient else 'Add New Patient' }}
            </p>
        </div>

        <!-- Patient Form -->
        <form method="POST" class="space-y-4">
            {{ form.csrf_token }}
            <!-- Demographics Section -->
            <div class="px-4">
                <h3 class="text-white text-lg font-bold mb-4">Demographic Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <!-- Patient Name -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Patient Name *</p>
                        <input
                            name="name"
                            type="text"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                            value="{{ patient.name if patient else '' }}"
                            placeholder="Enter full name"
                        />
                    </label>

                    <!-- Age -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Age *</p>
                        <input
                            name="age"
                            type="number"
                            min="0"
                            max="120"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                            value="{{ patient.age if patient else '' }}"
                            placeholder="Enter age"
                        />
                    </label>

                    <!-- Gender -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Gender *</p>
                        <select
                            name="gender"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 bg-[image:--select-button-svg] placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                        >
                            <option value="">Select Gender</option>
                            <option value="Male" {% if patient and patient.gender == 'Male' %}selected{% endif %}>Male</option>
                            <option value="Female" {% if patient and patient.gender == 'Female' %}selected{% endif %}>Female</option>
                            <option value="Other" {% if patient and patient.gender == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </label>

                    <!-- Marital Status -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Marital Status *</p>
                        <select
                            name="ever_married"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 bg-[image:--select-button-svg] placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                        >
                            <option value="">Select Status</option>
                            <option value="Yes" {% if patient and patient.ever_married == 'Yes' %}selected{% endif %}>Married</option>
                            <option value="No" {% if patient and patient.ever_married == 'No' %}selected{% endif %}>Single</option>
                        </select>
                    </label>

                    <!-- Work Type -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Work Type *</p>
                        <select
                            name="work_type"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 bg-[image:--select-button-svg] placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                        >
                            <option value="">Select Work Type</option>
                            <option value="Private" {% if patient and patient.work_type == 'Private' %}selected{% endif %}>Private</option>
                            <option value="Self-employed" {% if patient and patient.work_type == 'Self-employed' %}selected{% endif %}>Self-employed</option>
                            <option value="Govt_job" {% if patient and patient.work_type == 'Govt_job' %}selected{% endif %}>Government Job</option>
                            <option value="Children" {% if patient and patient.work_type == 'Children' %}selected{% endif %}>Student/Child</option>
                            <option value="Never_worked" {% if patient and patient.work_type == 'Never_worked' %}selected{% endif %}>Never Worked</option>
                        </select>
                    </label>

                    <!-- Residence Type -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Residence Type *</p>
                        <select
                            name="residence_type"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 bg-[image:--select-button-svg] placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                        >
                            <option value="">Select Residence</option>
                            <option value="Urban" {% if patient and patient.residence_type == 'Urban' %}selected{% endif %}>Urban</option>
                            <option value="Rural" {% if patient and patient.residence_type == 'Rural' %}selected{% endif %}>Rural</option>
                        </select>
                    </label>
                </div>
            </div>

            <!-- Medical Information Section -->
            <div class="px-4">
                <h3 class="text-white text-lg font-bold mb-4">Medical Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <!-- Hypertension -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Hypertension *</p>
                        <select
                            name="hypertension"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 bg-[image:--select-button-svg] placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                        >
                            <option value="">Select Status</option>
                            <option value="1" {% if patient and patient.hypertension == 1 %}selected{% endif %}>Yes</option>
                            <option value="0" {% if patient and patient.hypertension == 0 %}selected{% endif %}>No</option>
                        </select>
                    </label>

                    <!-- Average Glucose Level -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Average Glucose Level (mg/dL) *</p>
                        <input
                            name="avg_glucose_level"
                            type="number"
                            step="0.1"
                            min="0"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                            value="{{ patient.avg_glucose_level if patient else '' }}"
                            placeholder="Enter glucose level"
                        />
                    </label>

                    <!-- BMI -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">BMI *</p>
                        <input
                            name="bmi"
                            type="number"
                            step="0.1"
                            min="0"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                            value="{{ patient.bmi if patient else '' }}"
                            placeholder="Enter BMI"
                        />
                    </label>

                    <!-- Smoking Status -->
                    <label class="flex flex-col">
                        <p class="text-white text-base font-medium leading-normal pb-2">Smoking Status *</p>
                        <select
                            name="smoking_status"
                            required
                            class="form-input flex w-full resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-0 border border-hospital-border bg-hospital-input focus:border-medical-blue h-14 bg-[image:--select-button-svg] placeholder:text-hospital-text-light p-[15px] text-base font-normal leading-normal transition-colors"
                        >
                            <option value="">Select Status</option>
                            <option value="formerly smoked" {% if patient and patient.smoking_status == 'formerly smoked' %}selected{% endif %}>Formerly Smoked</option>
                            <option value="never smoked" {% if patient and patient.smoking_status == 'never smoked' %}selected{% endif %}>Never Smoked</option>
                            <option value="smokes" {% if patient and patient.smoking_status == 'smokes' %}selected{% endif %}>Currently Smokes</option>
                            <option value="Unknown" {% if patient and patient.smoking_status == 'Unknown' %}selected{% endif %}>Unknown</option>
                        </select>
                    </label>
                </div>
            </div>

            <!-- Risk Score Display -->
            <div class="px-4">
                <p class="text-hospital-text-light text-sm font-normal leading-normal pb-3 pt-1">
                    Risk Score: <span class="text-white font-bold">{{ risk_score if risk_score else '0' }}%</span>
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-stretch">
                <div class="flex flex-1 gap-3 flex-wrap px-4 py-3 justify-end">
                    <!-- Cancel Button -->
                    <a href="{{ url_for('patient.patient_list') }}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-hospital-card text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-hospital-border transition-colors">
                        <span class="truncate">Cancel</span>
                    </a>
                    <!-- Save/Update Button -->
                    <button type="submit" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-medical-blue text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-blue-700 transition-colors">
                        <span class="truncate">{{ 'Update' if patient else 'Save' }} Patient</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}